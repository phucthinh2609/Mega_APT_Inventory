<!DOCTYPE html>
<html lang="en">

    <head>
        <title>Create Purchase Order Page</title>

        <!-- Meta -->
        <th:block th:replace="/layout/head/meta"/>
        <!-- App-favicon -->
        <th:block th:replace="/layout/head/app-favicon"/>
        <!-- Touch-spin-css -->
        <th:block th:replace="/layout/head/bootstrap-touchspin-css"/>
        <!-- twitter-bootstrap-wizard css -->
        <th:block th:replace="/layout/head/twitter-bootstrap-wizard"/>
        <!-- Main -->
        <th:block th:replace="/layout/head/main"/>
        <!-- Font-awesome-css -->
        <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
        <!-- Custom css -->
        <th:block th:replace="/layout/head/custom-css"/>

    </head>

    <body data-sidebar="dark">

        <!-- Begin page -->
        <div id="layout-wrapper">
            <!-- Begin page-topbar -->
            <th:block th:replace="/layout/page-topbar :: page-topbar"/>
            <!-- End page-topbar -->

            <!-- Begin vertical-menu -->
            <th:block th:replace="/layout/vertical-menu :: vertical-menu"/>
            <!-- End vertical-menu -->

            <!-- Left Sidebar End -->

            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content">
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box d-flex align-items-center justify-content-between">
                                    <h4 class="mb-0 font-size-18">Create Purchase Order</h4>
                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Purchase Order</a></li>
                                            <li class="breadcrumb-item active">Create</li>
                                        </ol>
                                    </div>

                                </div>
                                <div class="position-relative col-sm-8 mb-3">
                                    <input type="text" class="form-control" placeholder="Search product...">
                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="card-title mb-4">Basic pills Wizard</h4>

                                        <div id="basic-pills-wizard" class="twitter-bs-wizard">
                                            <ul class="twitter-bs-wizard-nav">
                                                <li class="nav-item">
                                                    <a href="#select-product" class="nav-link" data-toggle="tab">
                                                        <span class="step-number mr-2">01</span>
                                                        Select product
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#delivery-info" class="nav-link" data-toggle="tab">
                                                        <span class="step-number mr-2">02</span>
                                                        <span>Delivery infomation</span>
                                                    </a>
                                                </li>

                                                <li class="nav-item">
                                                    <a href="#order-status" class="nav-link" data-toggle="tab">
                                                        <span class="step-number mr-2">03</span>
                                                        Order status
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#confirm-detail" class="nav-link" data-toggle="tab">
                                                        <span class="step-number mr-2">04</span>
                                                        Confirm Detail
                                                    </a>
                                                </li>
                                            </ul>

                                            <div class="tab-content twitter-bs-wizard-tab-content">
                                                <div class="tab-pane form-group" id="select-product">
                                                    <div class="position-relative col-sm-12 mb-3">
                                                        <input type="text" class="form-control" placeholder="Search product...">
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-centered mb-0 table-nowrap text-center">
                                                            <thead class="thead-light">
                                                            <tr>
                                                                <th>Image</th>
                                                                <th>Title</th>
                                                                <th>Price</th>
                                                                <th>Available</th>
                                                                <th>Quantity</th>
                                                                <th colspan="2">Total</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr>
                                                                <td>
                                                                    <img src="\assets\images\product\img-1.png" alt="product-img" title="product-img" class="avatar-md">
                                                                </td>
                                                                <td>
                                                                    <a href="/products/details/${slug}" class="text-dark text-left">Half sleeve T-shirt</a>

                                                                </td>
                                                                <td>
                                                                    $ 450
                                                                </td>
                                                                <td>
                                                                    10
                                                                </td>
                                                                <td>
                                                                    <div style="width: 120px;">
                                                                        <div class="input-group bootstrap-touchspin bootstrap-touchspin-injected">
                                                                            <span class="input-group-btn input-group-prepend bootstrap-touchspin-injected"><button class="btn btn-primary bootstrap-touchspin-down" type="button">-</button></span><input type="text" value="02" name="demo_vertical" class="form-control"><span class="input-group-btn input-group-append bootstrap-touchspin-injected"><button class="btn btn-primary bootstrap-touchspin-up" type="button">+</button></span>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    $ 900
                                                                </td>
                                                                <td>
                                                                    <a href="javascript:void(0);" class="action-icon text-danger"> <i class="mdi mdi-trash-can font-size-18"></i></a>
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                            <tfoot>
                                                            <tr>
                                                                <td colspan="4"></td>
                                                                <td>Total Quantity: </td>
                                                                <td class="text-right" colspan="2" id="totalQuantity">10</td>
                                                            </tr>
                                                            <tr>
                                                                <td colspan="4"></td>
                                                                <td>Total Amount: </td>
                                                                <td class="text-right font-size-15" colspan="2"><b id="totalAmount">1,857</b> đ</td>
                                                            </tr>
                                                            </tfoot>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="tab-pane" id="delivery-info">
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label for="companyName">Company Name</label>
                                                                <input type="text" class="form-control" id="companyName">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="email">Email</label>
                                                                <input type="email" class="form-control" id="email">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="province">Province</label>
                                                                <input type="text" class="form-control" id="province">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="ward">Ward</label>
                                                                <input type="text" class="form-control" id="ward">
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label for="fullName">Full name</label>
                                                                <input type="text" class="form-control" id="fullName">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="phone">Phone</label>
                                                                <input type="text" class="form-control" id="phone">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="district">District</label>
                                                                <input type="text" class="form-control" id="district">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="address">Address</label>
                                                                <input type="text" class="form-control" id="address">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane" id="order-status">
                                                    <div class="row mt-3">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Order Status</label>
                                                                <select class="custom-select">
                                                                    <option value="PENDING">Đang chờ xử lý</option>
                                                                    <option value="DELIVERY">Đang giao hàng</option>
                                                                    <option value="COMPLETE">Hoàn thành</option>
                                                                    <option value="CANCELLED">Huỷ đơn</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane" id="confirm-detail">
                                                    <div class="row justify-content-center">
                                                        <div class="col-lg-6">
                                                            <div class="text-center">
                                                                <div class="mb-4">
                                                                    <i class="mdi mdi-check-circle-outline text-success display-4"></i>
                                                                </div>
                                                                <div>
                                                                    <h5>Confirm Detail</h5>
                                                                    <p class="text-muted">If several languages coalesce, the grammar of the resulting</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <ul class="pager wizard twitter-bs-wizard-pager-link">
                                                <li class="previous"><a href="#">Previous</a></li>
                                                <li class="next"><a href="#">Next</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end row -->
                    </div>
                    <!-- container-fluid -->
                </div>
                <!-- Footer Start -->
                <footer class="footer">
                    <th:block th:replace="/layout/head/error-collapse"/>
                </footer>
                <!-- End Footer -->
            </div>
            <!-- End Page-content -->
        </div>
        <!-- END layout-wrapper -->
        <div class="loader hide"></div>

        <!-- Right Sidebar -->
        <th:block th:replace="/layout/right-bar :: right-bar"/>
        <!-- End right-bar -->

        <!-- JAVASCRIPT -->
        <th:block th:replace="/layout/script/javascript :: javascript"/>
        <!-- Touch-spin Js -->
        <th:block th:replace="/layout/script/bootrstrap-touchspin-js"/>
        <!-- twitter-bootstrap-wizard js -->
        <th:block th:replace="/layout/script/twitter-bootstrap-wizard"/>

        <!-- form wizard init -->
        <th:block th:replace="/layout/script/form-wizard"/>
        <!-- App js -->
        <th:block th:replace="/layout/script/app-js :: app-js"/>
    </body>

    <script>

        let page = {
            url: {
                getAllProvinces: App.GET_PROVINCES + "/",
                getAllDistricts: App.GET_PROVINCES + "/district/",
                getAllWards: App.GET_PROVINCES + "/ward/",

            },
            elements: {
                role: {},
                userInfo: {
                    locationRegion: {}
                },

            },
            loadData: {},
            commands: {},
            dialogs: {
                elements: {},
                commands: {},
                alertDanger: {}
            },

            initializeControlEvent: {}
        }

        let locationRegion = {};


        page.elements.companyName = $('#companyName');
        page.elements.fullName = $('#fullName');
        page.elements.phone = $('#phone');
        page.elements.email = $('#email');

        page.elements.address = $('#address');
        page.elements.ward = $('#ward');
        page.elements.district = $('#district');
        page.elements.province = $('#province');

        page.elements.totalAmount = $('#totalAmount');
        page.elements.totalQuantity = $('#totalQuantity');


        page.elements.footerAccordion = $(".footer-modal section.accordion");
        page.elements.footerContent = $(".footer-modal section.accordion .content");
        page.elements.accordionCollapse = $('input[name=collapse]');


        page.commands.drawProvinces = () => {
            return $.ajax({
                "headers": {
                    "accept": "application/json",
                    "content-type": "application/json"
                },
                "type": "GET",
                "url": page.url.getAllProvinces
            })
                .done((data) => {
                    $.each(data.results, (i, item) => {
                        let str = `<option value="${item.province_id}">${item.province_name}</option>`;

                        page.elements.province.append(str);
                    })
                })
                .fail((jqxHR) => {
                    console.log(jqxHR);
                })
        }

        page.commands.drawDistricts = (provinceId) => {
            return $.ajax({
                "headers": {
                    accept: "application/json",
                    "content-type": "application/json"
                },
                "type": "GET",
                "url": page.url.getAllDistricts + provinceId
            })
                .done((data) => {

                    if (data.results.length === 0) {
                        App.IziToast.showErrorAlert("Loading of districts is fail");
                    }else {
                        $.each(data.results, (i, item) => {
                            let str = `<option value="${item.district_id}">${item.district_name}</option>`;

                            page.elements.district.append(str);
                        })
                    }
                })
        }

        page.commands.drawWards = (districtId) => {
            return $.ajax({
                "headers": {
                    "accept": "application/json",
                    "content-type": "application/json"
                },
                "type": "GET",
                "url": page.url.getAllWards + districtId

            })
                .done((data) => {
                    if (data.results.length === 0) {
                        App.IziToast.showErrorAlert("Loading of wards is fail");
                    }else {
                        $.each(data.results, (i, item) => {
                            let str = `<option value="${item.ward_id}">${item.ward_name}</option>`;

                            page.elements.ward.append(str);
                        })
                    }
                })
        }

        page.dialogs.commands.provinceChange = () => {
            return $.ajax({
                "type": "GET",
                "url": page.url.getAllDistricts + locationRegion.provinceId
            }).done((data) => {
                page.elements.district.empty();

                $.each(data.results, (i, item) => {
                    let str = `<option value="${item.district_id}">${item.district_name}</option>`;

                    page.elements.district.append(str);
                });
            }).fail(function () {
                App.IziToast.showErrorAlert("Loading of districts is fail");
            });
        }

        page.dialogs.commands.districtChange = () => {
            $.ajax({
                "type": "GET",
                "url": page.url.getAllWards + locationRegion.districtId

            }).done((data) => {
                page.elements.ward.empty();

                $.each(data.results, (i, item) => {
                    let str = `<option value="${item.ward_id}">${item.ward_name}</option>`;

                    page.elements.ward.append(str);
                });
            }).fail(function () {
                App.IziToast.showErrorAlert("Loading of wards is fail");
            });
        }

        page.commands.unbindAll = () => {
            $('.delete').off();
        }

        page.initializeControlEvent = () => {
            page.elements.province.on('change', function () {
                locationRegion.provinceId = page.elements.province.val();

                page.dialogs.commands.provinceChange().done(function () {
                    locationRegion.districtId = page.elements.district.prop("selectedIndex", 0).val();
                    page.dialogs.commands.districtChange();
                })
            })

            page.elements.district.on('change', function () {
                locationRegion.districtId = page.elements.district.val();
                page.dialogs.commands.districtChange();
            })
        }

        $(function () {

            page.commands.drawProvinces().then(function (){
                let provinceId = page.elements.province.prop("selectedIndex", 0).val();

                if (provinceId != null) {
                    page.commands.drawDistricts(provinceId).then(function (){
                        let districtId = page.elements.district.prop("selectedIndex", 0).val();

                        if (districtId != null){
                            page.commands.drawWards(districtId);
                        }
                    })
                }
            });

            page.initializeControlEvent();
        })


    </script>


</html>