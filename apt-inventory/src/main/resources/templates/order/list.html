<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Home Page</title>

    <!-- Meta -->
    <th:block th:replace="/layout/head/meta :: meta"/>
    <!-- App-favicon -->
    <th:block th:replace="/layout/head/app-favicon :: app-favicon"/>
    <!-- Main -->
    <th:block th:replace="/layout/head/main :: main"/>

    <link rel="stylesheet" href="/assets/css/tooltip.css">

</head>

<body data-sidebar="dark">

<!-- Begin page -->
<div id="layout-wrapper">
    <!-- Begin page-topbar -->
    <th:block th:replace="/layout/page-topbar :: page-topbar"/>
    <!-- End page-topbar -->

    <!-- Begin vertical-menu -->
    <th:block th:replace="/layout/vertical-menu :: vertical-menu"/>
    <!-- End vertical-menu -->

    <!-- Left Sidebar End -->

    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-flex align-items-center justify-content-between">
                            <h4 class="mb-0 font-size-18">Purchase Order List</h4>

                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Purchase Order</a></li>
                                    <li class="breadcrumb-item active">List</li>
                                </ol>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- end page title -->

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-sm-4">
                                        <div class="search-box mr-2 mb-2 d-inline-block">
                                            <div class="position-relative">
                                                <input type="text" class="form-control" placeholder="Search...">
                                                <i class="bx bx-search-alt search-icon"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="text-sm-right">
                                            <button type="button" class="btn btn-success btn-rounded waves-effect waves-light mb-2 mr-2"><i class="mdi mdi-plus mr-1"></i> Add New Order</button>
                                        </div>
                                    </div><!-- end col-->
                                </div>

                                <div class="table-responsive">
                                    <table id="tablePurchaseOrder" class="table table-centered table-nowrap text-center">
                                        <thead class="thead-light">
                                        <tr>
                                            <th style="width: 20px;">
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="customCheck1">
                                                    <label class="custom-control-label" for="customCheck1">&nbsp;</label>
                                                </div>
                                            </th>
                                            <th>Order ID</th>
                                            <th>Total Amount</th>
                                            <th>Quantity Total</th>
                                            <th>Customer</th>
                                            <th>Status</th>
                                            <th>View Details</th>
                                            <th>State Change</th>
                                            <th>Action</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        </tbody>
                                    </table>
                                </div>
                                <ul class="pagination pagination-rounded justify-content-end mb-2">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="javascript: void(0);" aria-label="Previous">
                                            <i class="mdi mdi-chevron-left"></i>
                                        </a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="javascript: void(0);">1</a></li>
                                    <li class="page-item"><a class="page-link" href="javascript: void(0);">2</a></li>
                                    <li class="page-item"><a class="page-link" href="javascript: void(0);">3</a></li>
                                    <li class="page-item"><a class="page-link" href="javascript: void(0);">4</a></li>
                                    <li class="page-item"><a class="page-link" href="javascript: void(0);">5</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="javascript: void(0);" aria-label="Next">
                                            <i class="mdi mdi-chevron-right"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end row -->
            </div>

            <!-- container-fluid -->
        </div>
    </div>
    <!-- End Page-content -->
</div>
<!-- END layout-wrapper -->

<!-- Right Sidebar -->
<th:block th:replace="/layout/right-bar :: right-bar"/>
<!-- End right-bar -->

<th:block th:replace="/order/modal-details :: modal-details"/>

<th:block th:replace="/order/modal-description :: modal-description"/>

<!-- JAVASCRIPT -->
<th:block th:replace="/layout/script/javascript :: javascript"/>
<!-- App js -->
<th:block th:replace="/layout/script/app-js :: app-js"/>


<script>
    let page = {
        urls: {
            getAllOrders: App.BASER_URL + "/orders",
            getAllDetailByOrderId : App.BASER_URL + "/order-detail/"
        },
        elements: {
        },
        loadData: {},
        commands: {},
        dialogs: {
            elements: {},
            commands: {},
            alertDanger: {}
        },
    }


    page.elements.modalDetail = $('#modalDetail');
    page.elements.modalDescription = $('#mdDescription');

    page.elements.tbodyOrder = $('#tablePurchaseOrder tbody');

    page.elements.tbodyDetail = $('#tableDetails tbody');

    page.elements.btnCloseModal = $('.closeModal');
    page.elements.btnSaveDescription = $('#btnCancelOrder');

    page.elements.orderId = $('#orderId');
    page.elements.customer = $('#customer');
    page.elements.quantityTotal = $('#quantityTotal');
    page.elements.totalAmount = $('#totalAmount');

    page.commands.showModalDetails = () => {
        page.elements.btnShowDetail = $('#tablePurchaseOrder tbody tr td .showDetail');
        page.elements.btnShowDetail.on('click',function (){
            let orderId = $(this).data("id");
            page.elements.tbodyDetail.html("");
            page.commands.getAllOrderDetails(orderId).then(() => {
                $.each(orderDetail, (i, item) => {
                    let str = App.renderOrderDetail(item);
                    page.elements.tbodyDetail.append(str);
                })
                page.elements.orderId.text(orderDetail[0].order.id);
                page.elements.customer.text(orderDetail[0].order.customer.fullName);
                page.elements.quantityTotal.text(orderDetail[0].order.quantityTotal);
                page.elements.totalAmount.text(orderDetail[0].order.totalAmount + " VNĐ");
                page.elements.modalDetail.modal('show');
            })
        })
    }

    page.commands.closeModal = () => {
        page.elements.btnCloseModal.on('click',() => {
            page.elements.modalDetail.modal('hide');
        })
    }

    let orders = [];
    let orderDetail = [];

    page.commands.getAllOrderDetails = (orderId) => {
        console.log(orderId);
        return $.ajax({
                        headers: {
                            "accept": "application/json",
                            "content-type": "application/json"
                        },
                        type: "GET",
                        url: page.urls.getAllDetailByOrderId + orderId
                    })
                    .done((data) => {
                        orderDetail = data;
                    })
                    .fail((jqXHR) => {
                        console.log(jqXHR);
                    })
    }
    page.commands.getAllOrders = () => {
        let employeeId = 1;
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: page.urls.getAllOrders + "/" + employeeId
        })
        .done((data) => {
            orders = data;
        })
        .fail((jqXHR) => {
            console.log(jqXHR);
        })
    }

    page.commands.showModalDescription = () => {
        page.elements.btnShowDescription = $('.cancelled');
        page.elements.btnShowDescription.on('click',function () {
            let orderId = $(this).data("id");
            console.log(orderId);
            page.elements.btnSaveDescription.data("id",orderId);
            page.elements.modalDescription.modal("show");
        })
    }

    $(() => {
        page.commands.getAllOrders().then(() => {
            $.each(orders, (i, item) => {
                let str = App.renderOrders(item);
                page.elements.tbodyOrder.append(str);
            })
            page.commands.showModalDetails();
            page.commands.showModalDescription();
            page.commands.closeModal();
        })
    })
</script>

</body>
</html>
